;robot model meta-information
model_information {
  removeJoints {

  }
  baseFrame         "base_footprint"
  eleFrame          "left_gripper_tool_frame"
  ereFrame          "right_gripper_tool_frame"
}
model_settings
{
  usePreComputation               false
  recompileLibraries              true
}

; DDP settings
ddp
{
  algorithm                       SLQ

  nThreads                        4 
  threadPriority                  20

  maxNumIterations                1
  minRelCost                      0.1
  constraintTolerance             1e-3

  displayInfo                     false
  displayShortSummary             false
  checkNumericalStability         false
  debugPrintRollout               false
  debugCaching                    false

  AbsTolODE                       1e-3
  RelTolODE                       1e-2
  maxNumStepsPerSecond            10000
  timeStep                        1e-2
  backwardPassIntegratorType      ODE45

  constraintPenaltyInitialValue   20.0
  constraintPenaltyIncreaseRate   2.0

  preComputeRiccatiTerms          true

  useFeedbackPolicy               true

  strategy                        LINE_SEARCH
  lineSearch
  {
    minStepLength                 1e-2
    maxStepLength                 1.0
    hessianCorrectionStrategy     DIAGONAL_SHIFT
    hessianCorrectionMultiple     1e-3
  }
}

; Rollout settings
rollout
{
  AbsTolODE                       1e-5
  RelTolODE                       1e-4
  timeStep                        1e-2
  integratorType                  ODE45
  maxNumStepsPerSecond            100000
  checkNumericalStability         false
}

; MPC settings
mpc
{
  timeHorizon                     0.35  ; [s]
  solutionTimeWindow              0.3   ; [s]
  coldStart                       false
  
  debugPrint                      false

  mpcDesiredFrequency             100   ; [Hz]
  mrtDesiredFrequency             100   ; [Hz]
}
initialState
{
  endEffector
  {
    left_position
    {
      (0,0) -2.8;x
      (1,0) 1.1;y
      (2,0) 0.80;z
    }
    left_orientation
    {
      (0,0) -0.5;w
      (1,0) -0.50;x
      (2,0) 0.50;y
      (3,0) -0.50;z
    }
    right_position
    {
      (0,0) -3.20;x
      (1,0) 1.1;y
      (2,0) 0.80;z
    }
    right_orientation
    {
      (0,0) -0.5;w
      (1,0) -0.50;x
      (2,0)  0.50;y
      (3,0) -0.50;z
    }
    base_position
    {
      (0,0) -3.00;x
      (1,0)  1.9;y
      (2,0) 0.0;z
    }
    base_orientation;
    {
      (0,0) 0.707;w
      (1,0) 0.0;x
      (2,0) 0.0;y
      (3,0) -0.707;z
    }

  }
  base
  {
    (0,0) -3.0
    (1,0) 1.9
    (2,0) 0.0
  }
  torsoLift
  {
    (0,0)   0.10       ; torso_lift_joint
  }
  rightArm
  {
    (0,0)   0.00       ; r_shoulder_pan_joint
    (1,0)   0.25       ; r_shoulder_lift_joint
    (2,0)   -2.50     ; r_upper_arm_roll_joint
    (3,0)   -1.57     ; r_elbow_flex_joint
    (4,0)   0.050     ; r_forearm_roll_joint
    (5,0)   -1.57     ; r_wrist_flex_joint
    (6,0)   0.47     ; r_wrist_roll_joint
  }
  leftArm
  {
    (0,0)   0.00       ; l_shoulder_pan_joint
    (1,0)   0.25       ; l_shoulder_lift_joint
    (2,0)   2.50     ; l_upper_arm_roll_joint
    (3,0)   -1.57     ; l_elbow_flex_joint
    (4,0)   0.050     ; l_forearm_roll_joint
    (5,0)   -1.57     ; l_wrist_flex_joint
    (6,0)   0.47     ; l_wrist_roll_joint
  }
}
inputCost
{
  R
  {
    base
    {
      (0,0) 5.5 ; forward velocity
      (1,1) 5.5 ; turning velocity
      (2,2) 3.5 ; turning velocity
    }
    torsoLift
    {
      (0,0)   10.00       ; torso_lift_joint
    }
    rightArm
    {
      (0,0)   3.00     ; r_shoulder_pan_joint
      (1,1)   5.00     ; r_shoulder_lift_joint
      (2,2)   2.00     ; r_upper_arm_roll_joint
      (3,3)   2.50     ; r_elbow_flex_joint
      (4,4)   1.50     ; r_forearm_roll_joint
      (5,5)   1.00     ; r_wrist_flex_joint
      (6,6)   1.00     ; r_wrist_roll_joint
    }
    leftArm
    {
      (0,0)   3.00       ; l_shoulder_pan_joint
      (1,1)   5.00       ; l_shoulder_lift_joint
      (2,2)   2.00     ; l_upper_arm_roll_joint
      (3,3)   2.50     ; l_elbow_flex_joint
      (4,4)   1.50     ; l_forearm_roll_joint
      (5,5)   1.00     ; l_wrist_flex_joint
      (6,6)   1.00     ; l_wrist_roll_joint
    }
  }
}

endLeftEffector
{
  ; end effector quadratic penalty scaling
  muPosition      80.0
  muOrientation   40.0
}

finalEndLeftEffector
{
  muPosition      120.0
  muOrientation   80.0
}
endRightEffector
{
  ; end effector quadratic penalty scaling
  muPosition       80.0
  muOrientation    40.0
}

finalEndRightEffector
{
  muPosition      120.0
  muOrientation    80.0
}

endBase
{
  muPosition      50.0
  muOrientation   30.0
}

selfCollision
{
  ; activate self-collision constraint
  activate false

  ; Self Collision pairs
  collisionLinkPairs
  {

  }

  ; minimum distance allowed between the pairs
  minimumDistance  0.1

  ; relaxed log barrier mu
  mu     1e-2

  ; relaxed log barrier delta
  delta  1e-3
}
jointPositionLimits
{
  ; activate constraint
  activate true 

  ; relaxed log barrier mu
  mu      0.01

  ; relaxed log barrier delta
  delta   1e-3
}

jointVelocityLimits
{
  ; relaxed log barrier mu
  mu      0.01

  ; relaxed log barrier delta
  delta   1e-3

  lowerBound
  {
    ; velocity limits for the different types of arm base DOFs
    base
    {
      (0,0)  -0.5 ; forward velocity
      (1,0)  -0.5 ; turning velocity
      (2,0)  -1.0 ; turning velocity
    }

    ; velocity limits for the arm DOFs
    arm
    {
      (0,0)  -0.012    ; torso_lift_joint [m/s]
      (1,0)  -0.288    ; r_shoulder_pan_joint [rad/s]
      (2,0)  -0.282	     ; r_shoulder_lift_joint [rad/s]
      (3,0)  -0.3270	     ; r_upper_arm_roll_joint [rad/s]
      (4,0)  -0.3300	     ; r_elbow_flex_joint [rad/s]
      (5,0)  -0.599     ; r_forearm_roll_joint [rad/s]
      (6,0)  -0.8      ; r_wrist_flex_joint [m/s]
      (7,0)  -0.8      ; r_wrist_roll_joint [rad/s]
      (8,0)  -0.288	     ; l_shoulder_pan_joint [rad/s]
      (9,0)  -0.282	     ; l_shoulder_lift_joint [rad/s]
      (10,0)  -0.3270	   ; l_upper_arm_roll_joint [rad/s]
      (11,0)  -0.3300	   ; l_elbow_flex_joint [rad/s]
      (12,0)  -0.599	   ; l_forearm_roll_joint [rad/s]
      (13,0)  -0.8	   ; l_wrist_flex_joint [rad/s]
      (14,0)  -0.8	   ; l_wrist_roll_joint [rad/s]
    }
  }
  upperBound
  {
    ; velocity limits for the different types of arm base DOFs
    base
    {
      (0,0)  0.5 ; forward velocity
      (1,0)  0.5 ; turning velocity
      (2,0)  1.0 ; turning velocity
    }

    ; velocity limits for the arm DOFs
    arm
    {
      (0,0)  0.012    ; torso_lift_joint [m/s]
      (1,0)  0.288    ; r_shoulder_pan_joint [rad/s]
      (2,0)  0.282	     ; r_shoulder_lift_joint [rad/s]
      (3,0)  0.3270	     ; r_upper_arm_roll_joint [rad/s]
      (4,0)  0.3300	     ; r_elbow_flex_joint [rad/s]
      (5,0)  0.599     ; r_forearm_roll_joint [rad/s]
      (6,0)  0.8      ; r_wrist_flex_joint [m/s]
      (7,0)  0.8      ; r_wrist_roll_joint [rad/s]
      (8,0)  0.288	     ; l_shoulder_pan_joint [rad/s]
      (9,0)  0.282	     ; l_shoulder_lift_joint [rad/s]
      (10,0)  0.3270	   ; l_upper_arm_roll_joint [rad/s]
      (11,0)  0.3300	   ; l_elbow_flex_joint [rad/s]
      (12,0)  0.599	   ; l_forearm_roll_joint [rad/s]
      (13,0)  0.8	   ; l_wrist_flex_joint [rad/s]
      (14,0)  0.8	   ; l_wrist_roll_joint [rad/s]
    }
  }
}


